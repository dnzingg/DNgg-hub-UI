local Players = game:GetService("Players")
local player = Players.LocalPlayer

getgenv().DNggUI_values = getgenv().DNggUI_values or {}

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "DNggHubUI_Lib"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local main = Instance.new("Frame")
main.Name = "DNggMain"
main.Size = UDim2.new(0, 340, 0, 260)
main.Position = UDim2.new(0.35, 0, 0.28, 0)
main.BackgroundColor3 = Color3.fromRGB(18, 24, 40)
main.BorderSizePixel = 0
main.Active = true
main.Draggable = true
main.Parent = screenGui

local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1, -70, 0, 30)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Text = "DNgg Hub UI"
title.TextSize = 16
title.Font = Enum.Font.SourceSansBold
title.TextColor3 = Color3.fromRGB(220, 230, 255)
title.TextXAlignment = Enum.TextXAlignment.Left

local close = Instance.new("TextButton", main)
close.Size = UDim2.new(0, 24, 0, 24)
close.Position = UDim2.new(1, -30, 0, 4)
close.Text = "X"
close.Font = Enum.Font.SourceSansBold
close.TextSize = 14
close.BackgroundColor3 = Color3.fromRGB(150, 40, 40)
close.TextColor3 = Color3.fromRGB(255,255,255)
close.BorderSizePixel = 0

local minimize = Instance.new("TextButton", main)
minimize.Size = UDim2.new(0, 24, 0, 24)
minimize.Position = UDim2.new(1, -60, 0, 4)
minimize.Text = "-"
minimize.Font = Enum.Font.SourceSansBold
minimize.TextSize = 14
minimize.BackgroundColor3 = Color3.fromRGB(45,60,90)
minimize.TextColor3 = Color3.fromRGB(255,255,255)
minimize.BorderSizePixel = 0

local content = Instance.new("Frame", main)
content.Size = UDim2.new(1, -10, 1, -40)
content.Position = UDim2.new(0, 5, 0, 36)
content.BackgroundTransparency = 1
content.ClipsDescendants = true

local ui = {}
ui.__index = ui

local layout = Instance.new("UIListLayout", content)
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Padding = UDim.new(0, 6)

local function createBaseLine()
	local frame = Instance.new("Frame")
	frame.Size = UDim2.new(1, 0, 0, 28)
	frame.BackgroundTransparency = 1
	return frame
end

function ui:AddLabel(text)
	local line = createBaseLine()
	local label = Instance.new("TextLabel", line)
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = text
	label.Font = Enum.Font.SourceSans
	label.TextSize = 14
	label.TextColor3 = Color3.fromRGB(230,235,255)
	label.TextXAlignment = Enum.TextXAlignment.Left
	line.Parent = content
	return label
end

function ui:AddButton(text, callback)
	local line = createBaseLine()
	local btn = Instance.new("TextButton", line)
	btn.Size = UDim2.new(1, 0, 1, 0)
	btn.BackgroundColor3 = Color3.fromRGB(45,60,90)
	btn.BorderSizePixel = 0
	btn.Text = text
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 14
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.MouseButton1Click:Connect(function() pcall(callback) end)
	line.Parent = content
	return btn
end

function ui:AddToggle(name, default, callback)
	getgenv().DNggUI_values[name] = default and true or false
	local line = createBaseLine()
	local label = Instance.new("TextLabel", line)
	label.Size = UDim2.new(0.68, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = name
	label.Font = Enum.Font.SourceSans
	label.TextSize = 14
	label.TextColor3 = Color3.fromRGB(230,235,255)
	label.TextXAlignment = Enum.TextXAlignment.Left

	local btn = Instance.new("TextButton", line)
	btn.Size = UDim2.new(0.3, 0, 1, 0)
	btn.Position = UDim2.new(0.7, 0, 0, 0)
	btn.BorderSizePixel = 0
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 14
	btn.TextColor3 = Color3.fromRGB(255,255,255)

	local function refresh()
		if getgenv().DNggUI_values[name] then
			btn.BackgroundColor3 = Color3.fromRGB(0,170,80)
			btn.Text = "ON"
		else
			btn.BackgroundColor3 = Color3.fromRGB(170,40,40)
			btn.Text = "OFF"
		end
	end

	refresh()
	btn.MouseButton1Click:Connect(function()
		getgenv().DNggUI_values[name] = not getgenv().DNggUI_values[name]
		refresh()
		pcall(callback, getgenv().DNggUI_values[name])
	end)

	line.Parent = content
	return {
		Set = function(_, v) getgenv().DNggUI_values[name] = not not v; refresh(); pcall(callback, getgenv().DNggUI_values[name]) end,
		Get = function() return getgenv().DNggUI_values[name] end
	}
end

function ui:AddSlider(name, min, max, default, callback)
	getgenv().DNggUI_values[name] = tonumber(default) or tonumber(min) or 0
	local line = createBaseLine()
	local label = Instance.new("TextLabel", line)
	label.Size = UDim2.new(0.58, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = name .. ": " .. tostring(getgenv().DNggUI_values[name])
	label.Font = Enum.Font.SourceSans
	label.TextSize = 14
	label.TextColor3 = Color3.fromRGB(230,235,255)
	label.TextXAlignment = Enum.TextXAlignment.Left

	local box = Instance.new("TextBox", line)
	box.Size = UDim2.new(0.4, 0, 1, 0)
	box.Position = UDim2.new(0.58, 0, 0, 0)
	box.Text = tostring(getgenv().DNggUI_values[name])
	box.ClearTextOnFocus = true
	box.Font = Enum.Font.SourceSansBold
	box.TextSize = 14
	box.TextColor3 = Color3.fromRGB(255,255,255)
	box.BackgroundColor3 = Color3.fromRGB(35,45,70)
	box.BorderSizePixel = 0

	local function updateVal(v)
		local n = tonumber(v)
		if not n then n = tonumber(min) or 0 end
		if min and n < min then n = min end
		if max and n > max then n = max end
		getgenv().DNggUI_values[name] = n
		label.Text = name .. ": " .. tostring(n)
		box.Text = tostring(n)
		pcall(callback, n)
	end

	box.FocusLost:Connect(function(enter)
		updateVal(box.Text)
	end)

	line.Parent = content
	return {
		Set = function(_, v) updateVal(v) end,
		Get = function() return getgenv().DNggUI_values[name] end
	}
end

function ui:AddDropdown(name, options, defaultIndex, callback)
	if type(options) ~= "table" or #options == 0 then options = {"Option"} end
	local idx = tonumber(defaultIndex) or 1
	if idx < 1 then idx = 1 end
	if idx > #options then idx = 1 end
	getgenv().DNggUI_values[name] = options[idx]

	local line = createBaseLine()
	local label = Instance.new("TextLabel", line)
	label.Size = UDim2.new(0.6, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = name
	label.Font = Enum.Font.SourceSans
	label.TextSize = 14
	label.TextColor3 = Color3.fromRGB(230,235,255)
	label.TextXAlignment = Enum.TextXAlignment.Left

	local btn = Instance.new("TextButton", line)
	btn.Size = UDim2.new(0.38, 0, 1, 0)
	btn.Position = UDim2.new(0.62, 0, 0, 0)
	btn.Text = options[idx]
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 14
	btn.BackgroundColor3 = Color3.fromRGB(45,60,90)
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.BorderSizePixel = 0

	btn.MouseButton1Click:Connect(function()
		idx = idx + 1
		if idx > #options then idx = 1 end
		getgenv().DNggUI_values[name] = options[idx]
		btn.Text = options[idx]
		pcall(callback, options[idx])
	end)

	line.Parent = content
	return {
		Set = function(_, v)
			for i,opt in ipairs(options) do
				if opt == v then
					idx = i
					getgenv().DNggUI_values[name] = v
					btn.Text = v
					pcall(callback, v)
					return
				end
			end
		end,
		Get = function() return getgenv().DNggUI_values[name] end
	}
end

DNggUI = {}
setmetatable(DNggUI, {__index = ui})

local function clearContent()
	for _,child in ipairs(content:GetChildren()) do
		if not (child:IsA("UIListLayout")) then
			child:Destroy()
		end
	end
end

function DNggUI.Clear()
	clearContent()
end

function DNggUI.AddLabel(text) return ui.AddLabel(ui, text) end
function DNggUI.AddButton(text, cb) return ui.AddButton(ui, text, cb) end
function DNggUI.AddToggle(name, default, cb) return ui.AddToggle(ui, name, default, cb) end
function DNggUI.AddSlider(name, min, max, default, cb) return ui.AddSlider(ui, name, min, max, default, cb) end
function DNggUI.AddDropdown(name, options, defaultIndex, cb) return ui.AddDropdown(ui, name, options, defaultIndex, cb) end

close.MouseButton1Click:Connect(function()
	screenGui:Destroy()
end)

local minimized = false
minimize.MouseButton1Click:Connect(function()
	minimized = not minimized
	content.Visible = not minimized
	main.Size = minimized and UDim2.new(0, 340, 0, 38) or UDim2.new(0, 340, 0, 260)
end)

return DNggUI
