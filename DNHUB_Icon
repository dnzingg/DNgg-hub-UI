local uiParent = (gethui and gethui()) or game:GetService("CoreGui")

local G = Instance.new("ScreenGui")
G.Name = "DNHUB_DarkButton"
G.DisplayOrder = 10
G.ResetOnSpawn = false
G.ZIndexBehavior = Enum.ZIndexBehavior.Global
G.Parent = uiParent

local Btn = Instance.new("ImageButton")
Btn.Name = "DarkButton"
Btn.Parent = G
Btn.Size = UDim2.fromOffset(56, 56)
Btn.Position = UDim2.fromScale(0.06, 0.65)
Btn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Btn.BorderSizePixel = 0
Btn.Image = "rbxassetid://13270263721"

Instance.new("UICorner", Btn).CornerRadius = UDim.new(0.25, 0)
local gradient = Instance.new("UIGradient", Btn)
local stroke = Instance.new("UIStroke", Btn)
stroke.Thickness = 2

local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")

local dragging = false
local offset
local downPos
local clicked = false
local baseSize = Vector2.new(56, 56)

Btn.InputBegan:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		clicked = true
		downPos = UIS:GetMouseLocation()
		offset = Btn.AbsolutePosition - downPos
	end
end)

UIS.InputChanged:Connect(function(i)
	if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
		local pos = UIS:GetMouseLocation() + offset
		Btn.Position = UDim2.fromOffset(pos.X, pos.Y)
		if (UIS:GetMouseLocation() - downPos).Magnitude > 6 then
			clicked = false
		end
	end
end)

UIS.InputEnded:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseButton1 then
		if dragging then
			dragging = false
			if clicked then
				local t1 = TweenService:Create(Btn, TweenInfo.new(0.08, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.fromOffset(baseSize.X + 10, baseSize.Y + 10)})
				local t2 = TweenService:Create(Btn, TweenInfo.new(0.12, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.fromOffset(baseSize.X, baseSize.Y)})
				t1:Play()
				t1.Completed:Connect(function()
					t2:Play()
				end)
			end
		end
	end
end)

task.spawn(function()
	local t = 0
	while task.wait() do
		t = (t + 0.005) % 1
		local v = 0.35 + math.sin(t * math.pi * 2) * 0.15
		local c = Color3.fromHSV(0, 0, v)
		gradient.Color = ColorSequence.new(ColorSequenceKeypoint.new(0, c), ColorSequenceKeypoint.new(1, c))
		stroke.Color = c
	end
end)

local hover = TweenService:Create(Btn, TweenInfo.new(0.15, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {BackgroundColor3 = Color3.fromRGB(30, 30, 30)})
local leave = TweenService:Create(Btn, TweenInfo.new(0.15, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {BackgroundColor3 = Color3.fromRGB(20, 20, 20)})

Btn.MouseEnter:Connect(function()
	hover:Play()
end)

Btn.MouseLeave:Connect(function()
	leave:Play()
end)

return G, Btn
